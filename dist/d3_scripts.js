import{fetchData}from"./api.js";function updateVisualization(t){console.log("data log",t);const e=d3.select("#d3-visualization").append("svg").attr("width","100%").attr("height",600).attr("viewBox","0 0 1000 600").style("background-color","rgba(240, 240, 240, 0.5)").append("g").attr("transform","translate(50,20)"),a=d3.scaleLinear().range([0,920]),o=d3.scaleLinear().range([530,0]);a.domain(d3.extent(t,(t=>t.playCount))),o.domain(d3.extent(t,(t=>t.eggsCollected))),e.append("g").attr("transform","translate(0,530)").call(d3.axisBottom(a)),e.append("g").call(d3.axisLeft(o));const s=d3.select("#d3-visualization").append("div").attr("class","tooltip").style("opacity",0);e.selectAll(".dot").data(t).enter().append("circle").attr("class","dot").attr("cx",(t=>a(t.playCount))).attr("cy",(t=>o(t.eggsCollected))).attr("r",5).attr("fill","black").on("mouseover",(function(t,e){s.style("opacity",1).html(`Play Count: ${e.playCount}<br>Eggs Collected: ${e.eggsCollected}`).style("left",`${t.pageX+10}px`).style("top",t.pageY-10+"px")})).on("mousemove",(function(t,e){s.style("left",`${t.pageX+10}px`).style("top",t.pageY-10+"px")})).on("mouseout",(function(){s.style("opacity",0)}));const l=t.sort(((t,e)=>e.wins-t.wins)).slice(0,3);d3.select("#league-table tbody").selectAll("tr").data(l).enter().append("tr").html(((t,e)=>`\n                <tr>\n                    <td>${e+1}</td>\n                    <td>${t.userId}</td>\n                    <td>${t.wins}</td>\n                </tr>\n            `));const n=d3.select("#user-rank");document.getElementById("search-box").addEventListener("input",(function(){const l=this.value.toLowerCase(),d=t.filter((t=>t.userId.toLowerCase().includes(l)));e.selectAll(".dot").data(d).join((t=>t.append("circle").attr("class","dot")),(t=>t),(t=>t.remove())).attr("cx",(t=>a(t.playCount))).attr("cy",(t=>o(t.eggsCollected))).attr("r",5).attr("fill","red").on("mouseover",(function(t,e){s.style("opacity",1).html(`Play Count: ${e.playCount}<br>Eggs Collected: ${e.eggsCollected}`).style("left",`${t.pageX+10}px`).style("top",t.pageY-10+"px")})).on("mousemove",(function(t,e){s.style("left",`${t.pageX+10}px`).style("top",t.pageY-10+"px")})).on("mouseout",(function(){s.style("opacity",0)}));const r=t.find((t=>t.userId.toLowerCase()===l)),i=d3.selectAll("#league-table tbody tr");i.classed("highlight",!1),r?(n.html(`User: ${r.userId}<br>Rank: ${t.indexOf(r)+1}<br>Wins: ${r.wins}`),i.filter((t=>t.userId.toLowerCase()===l)).classed("highlight",!0)):n.html("User not found")}))}document.addEventListener("DOMContentLoaded",(async function(){console.log("d3 script fires");const t=sessionStorage.getItem("gameData");t?console.log("Data loaded from sessionStorage"):(await fetchData(),t=JSON.parse(sessionStorage.getItem(t)),console.log("data loaded from api")),updateVisualization(t),document.getElementById("refreshButton").addEventListener("click",(async()=>{console.log("Refresh button clicked. Fetching new data..."),await fetchData(),t=JSON.parse(sessionStorage.getItem("gameData")),updateVisualization(t)}))}));